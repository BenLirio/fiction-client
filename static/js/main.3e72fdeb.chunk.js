(this.webpackJsonpfiction=this.webpackJsonpfiction||[]).push([[0],{126:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(11),o=n.n(c),l=n(82),u=n(164),i=n(165),s=n(54),d=n(2),f=r.a.createContext({token:null,setToken:function(){}}),m=f,p=n(157),h=n(89),b=n(162),E=n(81),v=n.n(E),O=r.a.createContext({current:"",loading:!1,close:function(){}}),j=O,g="https://fiction-api.herokuapp.com",w="http://localhost:4741",x="localhost"===window.location.hostname?w:g,y=n(35),k=n.n(y),C=n(34),S=function(){var e=Object(a.useContext)(j),t=e.setLoading,n=e.close,r=e.setError,c=Object(a.useContext)(m),o=c.token,l=c.setToken,u=Object(C.f)();return{signUp:function(e){t(!0),r(!1),function(e){return k()({method:"POST",url:x+"/sign-up",data:{credentials:{email:e.email,password:e.password,password_confirmation:e.passwordConfirmation}}})}(e).then((function(){t(!1),n()})).catch((function(){t(!1),r(!0)}))},signIn:function(e){t(!0),r(!1),function(e){return k()({url:x+"/sign-in",method:"POST",data:{credentials:{email:e.email,password:e.password}}})}(e).then((function(e){var a=e.data;l(a.user.token),t(!1),localStorage.setItem("token",JSON.stringify(a.user.token)),n()})).catch((function(){t(!1),r(!0)}))},signOut:function(){t(!0),r(!1),function(e){return k()({url:x+"/sign-out",method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})}(o).then((function(){l(null),t(!1),localStorage.removeItem("token"),u.push("/")})).catch((function(){t(!1),r(!0)}))}}},N=function(){var e=r.a.useState(null),t=Object(d.a)(e,2),n=t[0],a=t[1],c=S().signOut,o=function(){a(null)};return r.a.createElement("div",null,r.a.createElement(p.a,{color:"inherit",onClick:function(e){a(e.currentTarget)}},r.a.createElement(v.a,null)),r.a.createElement(h.a,{anchorEl:n,open:Boolean(n),onClose:o},r.a.createElement(b.a,{onClick:o},"Profile"),r.a.createElement(b.a,{onClick:o},"My account"),r.a.createElement(b.a,{onClick:c},"Logout")))},T=n(163),I=function(){var e=Object(a.useContext)(j).open;return r.a.createElement(r.a.Fragment,null,r.a.createElement(T.a,{color:"inherit",onClick:function(){return e("SignIn")}},"Login"),r.a.createElement(T.a,{color:"secondary",variant:"contained",onClick:function(){return e("SignUp")}},"Create Account"))},P=Object(l.a)((function(e){return{root:{display:"flex"},appBar:{zIndex:e.zIndex.drawer+1},title:{flexGrow:1}}})),L=function(){var e=Object(a.useContext)(m).token,t=P();return r.a.createElement("div",{className:t.root},r.a.createElement(u.a,{className:t.appBar},r.a.createElement(i.a,null,r.a.createElement(s.a,{variant:"h5",className:t.title},"Fiction Writer"),e?r.a.createElement(N,null):r.a.createElement(I,null))),r.a.createElement(i.a,null))},J=n(171),B=n(161),W=n(128),_=n(166),z=n(9),R=n.n(z),A=function(){var e=Object(a.useContext)(m).token;return Object(a.useCallback)((function(t){var n=t.url,a=void 0===n?"":n,r=t.method,c=void 0===r?"GET":r,o=t.data,l=void 0===o?{}:o;return k()({url:"".concat(x,"/").concat(a),method:c,headers:{Authorization:"Bearer "+e},data:l})}),[e])},F=n(15),D=function(e,t){var n,a=t.payload;switch(t.type){case"index":return a.map((function(e){return{id:e._id,text:JSON.parse(e.text)}}));case"show":n=a._id;var r=e.filter((function(e){return e.id!==n})),c=e.find((function(e){return e.id===n}))||{};return c.text=JSON.parse(a.text),c.id=a._id,[].concat(Object(F.a)(r),[c]);case"create":var o={id:a._id,text:JSON.parse(a.text)};return[].concat(Object(F.a)(e),[o]);case"update":n=a._id;var l=e.filter((function(e){return e.id!==n})),u=e.find((function(e){return e.id===n}));return u.text=JSON.parse(a.text),[].concat(Object(F.a)(l),[u]);case"destroy":return n=a._id,e.filter((function(e){return e.id!==n}));default:throw new Error}},U=[],G=r.a.createContext(U),M=r.a.createContext(null),H=G,K=function(){var e=Object(a.useState)(!0),t=Object(d.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(!1),o=Object(d.a)(c,2),l=o[0],u=o[1],i=Object(a.useContext)(M),s=A();return{index:Object(a.useCallback)((function(){var e;return R.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return u(!1),r(!0),t.prev=2,t.next=5,R.a.awrap(s({url:"storys"}));case 5:e=t.sent,i({type:"index",payload:e.data.storys}),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),u(!0);case 12:r(!1);case 13:case"end":return t.stop()}}),null,null,[[2,9]])}),[s,i]),show:Object(a.useCallback)((function(e){var t;return R.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return u(!1),r(!0),n.prev=2,n.next=5,R.a.awrap(s({url:"".concat("storys","/").concat(e)}));case 5:t=n.sent,i({type:"show",payload:t.data.story}),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),u(!0);case 12:r(!1);case 13:case"end":return n.stop()}}),null,null,[[2,9]])}),[s,i]),create:Object(a.useCallback)((function(e){var t;return R.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return u(!1),r(!0),n.prev=2,n.next=5,R.a.awrap(s({url:"storys",method:"POST",data:{story:{text:e}}}));case 5:t=n.sent,i({type:"create",payload:t.data.story}),n.next=12;break;case 9:n.prev=9,n.t0=n.catch(2),u(!0);case 12:r(!1);case 13:case"end":return n.stop()}}),null,null,[[2,9]])}),[s,i]),update:Object(a.useCallback)((function(e,t){return R.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return u(!1),r(!0),n.prev=2,n.next=5,R.a.awrap(s({url:"".concat("storys","/").concat(e),method:"PATCH",data:{story:{text:t}}}));case 5:n.sent,n.next=11;break;case 8:n.prev=8,n.t0=n.catch(2),u(!0);case 11:r(!1);case 12:case"end":return n.stop()}}),null,null,[[2,8]])}),[s,i]),destroy:Object(a.useCallback)((function(e){return R.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return u(!1),r(!0),t.prev=2,t.next=5,R.a.awrap(s({url:"".concat("storys","/").concat(e),method:"DELETE"}));case 5:i({type:"destroy",id:e}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),u(!0);case 11:r(!1);case 12:case"end":return t.stop()}}),null,null,[[2,8]])}),[s,i]),loading:n,error:l}},$=Object(l.a)((function(e){return{drawer:{width:e.drawerWidth},drawerPaper:{width:e.drawerWidth},toolbar:e.mixins.toolbar}})),q=function(){var e=K(),t=Object(C.f)(),n=$();return r.a.createElement(J.a,{variant:"permanent",className:n.drawer,classes:{paper:n.drawerPaper}},r.a.createElement("div",{className:n.toolbar}),r.a.createElement(B.a,null,["New Story","Stories"].map((function(a){return r.a.createElement(W.a,{onClick:function(){return function(n){switch(n){case"New Story":e.create();break;case"Stories":t.push("/stories");break;default:throw new Error}}(a)},button:!0,key:a},r.a.createElement(_.a,{primary:a,className:n.listItem}))}))))},Q=Object(l.a)((function(e){return{root:{display:"flex"}}})),V=function(e){var t=e.children,n=Q();return r.a.createElement(r.a.Fragment,null,r.a.createElement(L,null),r.a.createElement("div",{className:n.root},r.a.createElement(q,null),t))},X=r.a.createContext({}),Y=function(e){var t=e.children,n=Object(C.g)().id,c=K(),o=c.show,l=c.loading,u=c.error,i=K().update,s=Object(a.useCallback)((function(e){i(n,JSON.stringify(e))}),[n]),d=K().destroy,f=Object(a.useCallback)((function(){d(n)}),[n]);Object(a.useEffect)((function(){o(n)}),[n]);var m=Object(a.useContext)(H).find((function(e){return e.id===n}));return m?r.a.createElement(X.Provider,{value:{story:m,loading:l,error:u,update:s,destroy:f}},t):null},Z=X,ee=n(53),te=n(3),ne=function(){var e=Object(a.useContext)(Z),t=e.update,n=e.story,r=Object(a.useState)(n.text),c=Object(d.a)(r,2),o=c[0],l=c[1];return Object(a.useEffect)((function(){var e=setTimeout((function(){t(o)}),1e3);return function(){clearTimeout(e)}}),[o]),[o,l]},ae=function(){return function(e){return r.a.createElement(s.a,Object.assign({variant:e.element.type},e))}},re=function(){return function(e){var t=e.leaf.color,n=void 0===t?"inherit":t;return r.a.createElement("span",Object.assign({style:{color:n}},e.attributes),e.children)}},ce=function(){var e=[["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"],["the","#faa"],["eht","#afa"]];return Object(a.useCallback)((function(t){var n=Object(d.a)(t,2),a=n[0],r=n[1],c=[];return e.forEach((function(e){if(e[0]&&te.f.isText(a)){var t=a.text.split(e[0]),n=0;t.forEach((function(t,a){0!==a&&c.push({anchor:{path:r,offset:n-e[0].length},focus:{path:r,offset:n},color:e[1]}),n=n+t.length+e[0].length}))}})),c}),[e])},oe=function(){return function(e,t){return null}},le=function(e){var t=e.normalizeNode;return e.normalizeNode=function(n){var a=Object(d.a)(n,2),r=a[0],c=a[1];if(0===c.length){var o=!0,l=!1,u=void 0;try{for(var i,s=te.c.children(e,c)[Symbol.iterator]();!(o=(i=s.next()).done);o=!0){var f=i.value,m=Object(d.a)(f,2),p=m[0],h=m[1],b=0===h[0]?"h4":"body1";p.type!==b&&te.g.setNodes(e,{type:b},{at:h})}}catch(E){l=!0,u=E}finally{try{o||null==s.return||s.return()}finally{if(l)throw u}}}return t([r,c])},e},ue=Object(l.a)((function(e){return{root:{width:400,background:e.palette.background.paper,boxShadow:e.shadows[3],margin:"20px auto 0",padding:20}}})),ie=function(){var e=ue(),t=Object(a.useMemo)((function(){return Object(ee.c)(le(Object(te.h)()))}),[]),n=ne(),c=Object(d.a)(n,2),o=c[0],l=c[1],u=ae(),i=re(),s=ce(),f=oe();return r.a.createElement("div",{className:e.root},r.a.createElement("div",null,r.a.createElement(ee.b,{editor:t,value:o,onChange:l},r.a.createElement(ee.a,{placeholder:"Title...",renderElement:u,renderLeaf:i,decorate:s,onKeyDown:function(e){return f(e,t)}}))))},se=function(){var e=Object(a.useContext)(Z),t=e.loading;if(e.error);else if(!t)return r.a.createElement(ie,null);return null},de=n(122),fe=function(){return function(){return JSON.stringify([{type:"h4",children:[{text:de().spaced}]},{type:"body1",children:[{text:"Write your fantastic story here..."}]}])}},me=n(30),pe=function(){var e=Object(a.useContext)(H),t=K(),n=t.index,c=t.create,o=t.loading,l=t.error,u=fe();Object(a.useEffect)((function(){n()}),[n]);var i=Object(a.useCallback)((function(){var e=u();c(e)}),[]);if(l)return r.a.createElement("p",null,"error");if(o)return r.a.createElement("p",null,"loading...");if(e)return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",null,e.length||"no stories"),r.a.createElement(T.a,{onClick:i},"Create story"),r.a.createElement("ul",null,e.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(me.b,{to:"stories/".concat(e.id)},e.text[0].children[0].text||"no data"))}))));throw new Error},he=function(){return r.a.createElement("div",null,"404 not found")},be=n(170),Ee=Object(l.a)((function(e){return{paper:{position:"absolute",left:"50%",top:"50%",width:400,height:400,backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],padding:e.spacing(2,4,3),borderRadius:e.shape.borderRadius,transform:"translate(-50%, -50%)"}}})),ve=function(e){var t=e.name,n=e.children,c=Object(a.useContext)(j),o=c.current,l=c.close,u=c.loading,i=c.setLoading,s=c.error,d=c.setError,f=Ee();return r.a.createElement(be.a,{open:o===t,onClose:function(){d(!1),i(!1),l()}},r.a.createElement("div",{className:f.paper},r.a.createElement("p",null,u&&"LOADING..."),r.a.createElement("p",null,s&&"!!!!ERROR!!!!"),n))},Oe=n(169),je=function(e){var t=Object(a.useState)(e),n=Object(d.a)(t,2),r=n[0],c=n[1];return[r,{value:r,onChange:function(e){return c(e.target.value)}},function(){return c("")}]},ge=function(){var e=S().signUp,t=je(""),n=Object(d.a)(t,2),a=n[0],c=n[1],o=je(""),l=Object(d.a)(o,2),u=l[0],i=l[1],s=je(""),f=Object(d.a)(s,2),m=f[0],p=f[1];return r.a.createElement(ve,{name:"SignUp"},r.a.createElement("form",null,r.a.createElement(Oe.a,Object.assign({label:"email"},c)),r.a.createElement(Oe.a,Object.assign({label:"password"},i)),r.a.createElement(Oe.a,Object.assign({label:"password confirmation"},p)),r.a.createElement(T.a,{onClick:function(){e({email:a,password:u,passwordConfirmation:m})}},"Login")))},we=function(){var e=je(""),t=Object(d.a)(e,2),n=t[0],a=t[1],c=je(""),o=Object(d.a)(c,2),l=o[0],u=o[1],i=S().signIn;return r.a.createElement(ve,{name:"SignIn"},r.a.createElement("form",null,r.a.createElement(Oe.a,Object.assign({label:"email"},a)),r.a.createElement(Oe.a,Object.assign({label:"password"},u)),r.a.createElement(T.a,{onClick:function(){i({email:n,password:l})}},"Login")))},xe=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(ge,null),r.a.createElement(we,null))},ye=function(){return r.a.createElement(V,null,r.a.createElement(xe,null),r.a.createElement(C.c,null,r.a.createElement(C.a,{path:"/404"},r.a.createElement(he,null)),r.a.createElement(C.a,{exact:!0,path:"/stories"},r.a.createElement(pe,null)),r.a.createElement(C.a,{path:"/stories/:id"},r.a.createElement(Y,null,r.a.createElement(se,null)))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ke=n(167),Ce=n(168),Se=n(88),Ne=Object(Se.a)({drawerWidth:240}),Te=r.a.createElement((function(e){var t=e.children,n=Object(a.useState)(JSON.parse(localStorage.getItem("token"))||null),c=Object(d.a)(n,2),o=c[0],l=c[1],u={token:o,setToken:Object(a.useCallback)((function(e){l(e)}),[])};return r.a.createElement(f.Provider,{value:u},t)}),null,r.a.createElement((function(e){var t=e.children,n=Object(a.useState)("none"),c=Object(d.a)(n,2),o=c[0],l=c[1],u=Object(a.useState)(!1),i=Object(d.a)(u,2),s=i[0],f=i[1],m=Object(a.useState)(!1),p=Object(d.a)(m,2),h={current:o,loading:s,setLoading:f,error:p[0],setError:p[1],close:function(){l("none")},open:function(e){l(e)}};return r.a.createElement(O.Provider,{value:h},t)}),null,r.a.createElement(ke.a,{theme:Ne},r.a.createElement(me.a,{basename:"/fiction-client/"},r.a.createElement((function(e){var t=e.children,n=Object(a.useReducer)(D,U),c=Object(d.a)(n,2),o=c[0],l=c[1];return r.a.createElement(G.Provider,{value:o},r.a.createElement(M.Provider,{value:l},t))}),null,r.a.createElement(Ce.a,null),r.a.createElement(ye,null))))));o.a.render(Te,document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},94:function(e,t,n){e.exports=n(126)}},[[94,1,2]]]);
//# sourceMappingURL=main.3e72fdeb.chunk.js.map